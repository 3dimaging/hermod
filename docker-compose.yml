version: '2'
services:
  nginxproxy:
    image: jwilder/nginx-proxy
    container_name: nginx-proxy
    restart: always
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - /etc/nginxcerts:/etc/nginx/certs
      - /var/docker/nginxproxy/vhosts:/etc/nginx/vhost.d
      - /var/www:/usr/share/nginx/html
      - ./nginx.tmpl:/app/nginx.tmpl
      - /var/docker/htpasswd:/etc/nginx/htpasswd
  nginxproxysslgen:
    #image: alastaircoote/docker-letsencrypt-nginx-proxy-companion
    image: jrcs/letsencrypt-nginx-proxy-companion:latest
    container_name: nginxproxysslgen
    restart: always
    volumes_from:
      - nginxproxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - /etc/nginxcerts:/etc/nginx/certs
      - /var/docker/nginxproxy/vhosts:/etc/nginx/vhost.d
      - /var/www:/usr/share/nginx/html      
    ## ===========================================================================================   
    ## HERMOD VOICE SERVICES SUITE
    ## ===========================================================================================   
  
  hermod:
        #build: ./
        image: hermod
        restart: always
        #privileged: true
        entrypoint: "/usr/src/app/hermod-nodejs/pm2start.sh"
        environment:
          VIRTUAL_HOST: hermod.local
          VIRTUAL_PORT: 3000
          LETSENCRYPT_HOST: hermod.local
          LETSENCRYPT_EMAIL: stever@syntithenai.com
          
        ports:
           # web
          - "3000:3000"
            # mqtt (debug) - disable for production
          - "1883:1883"
            # mqtt web sockets 
          - "9001:9001"
        # on your linux desktop install paprefs and enable network access to local sound devices 
        # update IP below to your machine
        environment: 
            - PULSE_SERVER=192.168.1.200
            - PULSE_COOKIE=/tmp/cookie
        volumes:
            #- /dev/snd:/dev/snd
            # HOST MOUNTS FOR DEVELOPMENT
            - ./hermod-nodejs:/usr/src/app/hermod-nodejs
            - ./hermod-react-satellite:/usr/src/app/hermod-react-satellite
            - ./browser-example:/usr/src/app/browser-example
            # Use PULSE
            - ./pulseaudio/asound-pulse.conf:/etc/asound.conf
            - ./pulseaudio/client.conf:/etc/pulse/client.conf
            # PULSE COOKIE FROM HOST
            - /home/stever/.config/pulse/cookie:/tmp/cookie
    
